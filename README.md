# Test-Agent: æ‚¨çš„æ™ºèƒ½æµ‹è¯•åŠ©ç†
<p align="center">
  <img src="https://github.com/codefuse-ai/MFTCoder/blob/main/assets/github-codefuse-logo-update.jpg" width="50%" />
</p>

<p align="center">
    <a href="https://github.com/codefuse-ai/Test-Agent">
        <img alt="stars" src="https://img.shields.io/github/stars/codefuse-ai/Test-Agent?style=social" />
    </a>
    <a href="https://github.com/codefuse-ai/Test-Agent">
        <img alt="forks" src="https://img.shields.io/github/forks/codefuse-ai/Test-Agent?style=social" />
    </a>
    <a href="https://github.com/codefuse-ai/Test-Agent/LICENCE">
      <img alt="License: MIT" src="https://badgen.net/badge/license/apache2.0/blue" />
    </a>
    <a href="https://github.com/codefuse-ai/Test-Agent/issues">
      <img alt="Open Issues" src="https://img.shields.io/github/issues-raw/codefuse-ai/Test-Agent" />
    </a>
</p>

### æœ¬åœ°Mac M1ä½“éªŒæ•ˆæœ
![å›¾ç‰‡](https://github.com/codefuse-ai/Test-Agent/assets/103973989/8dba860f-c1bb-49d5-b9dd-a58e541562a6)

### é­”æ­ä½“éªŒæ•ˆæœ
é­”æ­æ¨¡å‹è®¿é—®é“¾æ¥ï¼š[ModelScope TestGPT-7B](https://modelscope.cn/models/codefuse-ai/TestGPT-7B/summary)
![MS](https://github.com/codefuse-ai/Test-Agent/assets/103973989/0e50b258-44f9-4dc6-8e30-0a01cf62d02b)


## ä»€ä¹ˆæ˜¯Test Agentï¼Ÿï¼ˆIntroductionï¼‰

**Test Agent** æ—¨åœ¨æ„å»ºæµ‹è¯•é¢†åŸŸçš„â€œæ™ºèƒ½ä½“â€ï¼Œèåˆå¤§æ¨¡å‹å’Œè´¨é‡é¢†åŸŸå·¥ç¨‹åŒ–æŠ€æœ¯ï¼Œä¿ƒè¿›è´¨é‡æŠ€æœ¯ä»£ç³»å‡çº§ã€‚æˆ‘ä»¬æœŸæœ›å’Œç¤¾åŒºæˆå‘˜ä¸€èµ·åˆä½œï¼Œæ‰“é€ åˆ›æ–°çš„æµ‹è¯•é¢†åŸŸè§£å†³æ–¹æ¡ˆï¼Œæ„å»º24å°æ—¶åœ¨çº¿çš„æµ‹è¯•åŠ©ç†æœåŠ¡ï¼Œè®©æµ‹è¯•å¦‚ä¸èˆ¬é¡ºæ»‘ã€‚
## æœ¬æœŸç‰¹æ€§ï¼ˆFeaturesï¼‰

* **æ¨¡å‹** æœ¬æœŸæˆ‘ä»¬å¼€æºäº†æµ‹è¯•é¢†åŸŸæ¨¡å‹TestGPT-7Bã€‚æ¨¡å‹ä»¥CodeLlama-7Bä¸ºåŸºåº§ï¼Œè¿›è¡Œäº†ç›¸å…³ä¸‹æ¸¸ä»»åŠ¡çš„å¾®è°ƒï¼š
  * **å¤šè¯­è¨€æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆï¼ˆJava/Python/Javascriptï¼‰** ä¸€ç›´ä»¥æ¥éƒ½æ˜¯å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œéå¸¸å…³æ³¨çš„é¢†åŸŸï¼Œè¿‘å¹´æ¥ä¸æ–­æœ‰æ–°äº§å“æˆ–å·¥å…·å­µåŒ–å‡ºæ¥ï¼Œå¦‚EvoSuiteã€Randoopã€SmartUnitç­‰ã€‚ç„¶è€Œä¼ ç»Ÿçš„ç”¨ä¾‹ç”Ÿæˆå­˜åœ¨å…¶éš¾ä»¥è§£å†³çš„ç—›ç‚¹é—®é¢˜ï¼ŒåŸºäºå¤§æ¨¡å‹çš„æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆåœ¨æµ‹è¯•ç”¨ä¾‹å¯è¯»æ€§ã€æµ‹è¯•åœºæ™¯å®Œæ•´åº¦ã€å¤šè¯­è¨€æ”¯æŒæ–¹é¢éƒ½ä¼˜äºä¼ ç»Ÿç”¨ä¾‹ç”Ÿæˆå·¥å…·ã€‚æœ¬æ¬¡é‡ç‚¹æ”¯æŒäº†å¤šè¯­è¨€æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆï¼Œåœ¨æˆ‘ä»¬æœ¬æ¬¡å¼€æºçš„ç‰ˆæœ¬ä¸­é¦–å…ˆåŒ…å«äº†Javaã€Pythonã€Javascriptçš„æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆèƒ½åŠ›ï¼Œä¸‹ä¸€ç‰ˆæœ¬ä¸­é€æ­¥å¼€æ”¾Goã€C++ç­‰è¯­è¨€ã€‚
  * **æµ‹è¯•ç”¨ä¾‹Assertè¡¥å…¨**  å¯¹å½“å‰æµ‹è¯•ç”¨ä¾‹ç°çŠ¶çš„åˆ†æä¸æ¢æŸ¥æ—¶ï¼Œæˆ‘ä»¬å‘ç°ä»£ç ä»“åº“ä¸­å­˜åœ¨ä¸€å®šæ¯”ä¾‹çš„å­˜é‡æµ‹è¯•ç”¨ä¾‹ä¸­æœªåŒ…å«Assertã€‚æ²¡æœ‰Assertçš„æµ‹è¯•ç”¨ä¾‹è™½ç„¶èƒ½å¤Ÿåœ¨å›å½’è¿‡ç¨‹ä¸­æ‰§è¡Œé€šè¿‡ï¼Œå´æ— æ³•å‘ç°é—®é¢˜ã€‚å› æ­¤æˆ‘ä»¬æ‹“å±•äº†æµ‹è¯•ç”¨ä¾‹Assertè‡ªåŠ¨è¡¥å…¨è¿™ä¸€åœºæ™¯ã€‚é€šè¿‡è¯¥æ¨¡å‹èƒ½åŠ›ï¼Œç»“åˆä¸€å®šçš„å·¥ç¨‹åŒ–é…å¥—ï¼Œå¯ä»¥å®ç°å¯¹å…¨åº“æµ‹è¯•ç”¨ä¾‹çš„æ‰¹é‡è‡ªåŠ¨è¡¥å…¨ï¼Œæ™ºèƒ½æå‡é¡¹ç›®è´¨é‡æ°´ä½ã€‚

* **å·¥ç¨‹æ¡†æ¶** æœ¬åœ°æ¨¡å‹å¿«é€Ÿå‘å¸ƒå’Œä½“éªŒå·¥ç¨‹åŒ–æ¡†æ¶
  - ChatBoté¡µé¢
  - æ¨¡å‹å¿«é€Ÿå¯åŠ¨
  - ç§æœ‰åŒ–éƒ¨ç½²ï¼Œæœ¬åœ°åŒ–çš„GPTå¤§æ¨¡å‹ä¸æ‚¨çš„æ•°æ®å’Œç¯å¢ƒè¿›è¡Œäº¤äº’ï¼Œæ— æ•°æ®æ³„éœ²é£é™©ï¼Œ100%å®‰å…¨

**åç»­æˆ‘ä»¬ä¼šæŒç»­è¿­ä»£æ¨¡å‹å’Œå·¥ç¨‹åŒ–èƒ½åŠ›ï¼š**
- ä¸æ–­åŠ å…¥æ›´å¤šä»¤äººæ¿€åŠ¨çš„æµ‹è¯•åŸŸåº”ç”¨åœºæ™¯ï¼Œå¦‚é¢†åŸŸçŸ¥è¯†é—®ç­”ã€æµ‹è¯•åœºæ™¯åˆ†æç­‰
- æ”¯æ’‘é¢å‘æµ‹è¯•åœºæ™¯çš„copilot å·¥ç¨‹æ¡†æ¶å¼€æ”¾ï¼Œå¦‚æµ‹è¯•é¢†åŸŸçŸ¥è¯†æ™ºèƒ½embeddingã€æµ‹è¯•é€šç”¨å·¥å…·APIä½“ç³»ã€æ™ºèƒ½æµ‹è¯•Agentç­‰ï¼Œæ•¬è¯·æœŸå¾…ï¼
- ä»¥7Bä¸ºåŸºç¡€ï¼Œé€æ­¥æ‰©å±•è‡³13Bã€34Bæ¨¡å‹ã€‚æ¬¢è¿å…³æ³¨ï¼

## æ€§èƒ½æœ€å¼ºçš„7Bæµ‹è¯•é¢†åŸŸå¤§æ¨¡å‹ï¼ˆModelï¼‰
ç›®å‰åœ¨TestAgentä¸­ï¼Œæˆ‘ä»¬é»˜è®¤ä½¿ç”¨äº†TestGPT-7Bæ¨¡å‹ã€‚ä¸å½“å‰å·²æœ‰å¼€æºæ¨¡å‹ç›¸æ¯”ï¼Œ**TestGPT-7Bæ¨¡å‹åœ¨ç”¨ä¾‹æ‰§è¡Œé€šè¿‡ç‡ï¼ˆpass@1ï¼‰ã€ç”¨ä¾‹åœºæ™¯è¦†ç›–ï¼ˆå¹³å‡æµ‹è¯•åœºæ™¯æ•°ï¼‰ä¸Šéƒ½å¤„äºä¸šç•Œé¢†å…ˆæ°´å¹³ã€‚**
TestGPT-7Bæ¨¡å‹æ ¸å¿ƒèƒ½åŠ›çš„è¯„æµ‹ç»“æœå¦‚ä¸‹ï¼š
- å¤šè¯­è¨€æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ
é’ˆå¯¹æ¨¡å‹æ”¯æŒçš„ä¸‰ç§è¯­è¨€ï¼šJavaã€Pythonã€Javascriptï¼ŒPass@1è¯„æµ‹ç»“æœå¦‚ä¸‹ï¼š

| Model | Java pass@1 | Java Average number of test scenarios | Python pass@1 | Python Average number of test scenarios | Javascript pass@1 | Javascript Average number of test scenarios |
| --- | --- | --- | --- | --- | --- | --- |
| TestGPT-7B | 48.6% | 4.37 | 35.67% | 3.56 | 36% | 2.76 |
| CodeLlama-13B-Instruct | 40.54% | 1.08 | 30.57% | 1.65 | 31.7% | 3.13 |
| Qwen-14B-Chat | 10.81% | 2.78 | 15.9% | 1.32 | 9.15% | 4.22 |
| Baichuan2-13B-Chat | 13.5% | 2.24 | 12.7% | 2.12 | 6.1% | 3.31 |


- æµ‹è¯•ç”¨ä¾‹Assertè¡¥å…¨
ç›®å‰æ¨¡å‹æ”¯æŒJavaç”¨ä¾‹çš„Assertè¡¥å…¨ï¼ŒPass@1è¯„æµ‹ç»“æœå¦‚ä¸‹ï¼š

| Model | pass@1 | Percentage of strong validation |
| --- | --- | --- |
| Codefuse-TestGPT-7B | 71.1% | 100% |


## å·¥ç¨‹æ¶æ„ï¼ˆEngineering Architectureï¼‰
![JG](https://github.com/codefuse-ai/Test-Agent/assets/103973989/1b61beff-df59-4ab3-843c-266413c8dbc4)

å¤§æ¨¡å‹çš„å·è§’å·²ç»å¹å“ï¼Œæµ‹è¯•é¢†åŸŸå¤§æ¨¡å‹ä¹Ÿåœ¨ä¸æ–­è¿›åŒ–ä¸­ï¼Œé€šè¿‡é¢„è®­ç»ƒè¿‡ç¨‹ä¸­ç§¯ç´¯çš„ä¸°å¯Œä¸–ç•ŒçŸ¥è¯†ï¼Œåœ¨å¤æ‚äº¤äº’ç¯å¢ƒä¸­å±•ç°å‡ºäº†éå‡¡çš„æ¨ç†ä¸å†³ç­–èƒ½åŠ›ã€‚

å°½ç®¡åœ¨æµ‹è¯•é¢†åŸŸä¸­åŸºç¡€æ¨¡å‹å–å¾—äº†æ˜¾è‘—çš„æˆæœï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€äº›å±€é™æ€§ï¼Œç‰¹å®šé¢†åŸŸçš„æµ‹è¯•ä»»åŠ¡é€šå¸¸éœ€è¦ä¸“ä¸šåŒ–çš„å·¥å…·æˆ–é¢†åŸŸçŸ¥è¯†æ¥è§£å†³ã€‚ä¾‹å¦‚ï¼ŒåŸºç¡€æ¨¡å‹å¯ä»¥é€šè¿‡é¢„è®­ç»ƒçŸ¥è¯†å®Œæˆå•æ¬¡æµ‹è¯•ä»£ç ç”Ÿæˆå’Œæµ‹è¯•æ–‡æœ¬ç”Ÿæˆç­‰ä»»åŠ¡ï¼Œä½†å¤„ç†å¤æ‚çš„é›†æˆç”¨ä¾‹ç”Ÿæˆã€ç‰¹å®šé¢†åŸŸç”¨ä¾‹ç”Ÿæˆå’Œæµ‹è¯•æµç¨‹pipelineäº¤äº’ç­‰é—®é¢˜æ—¶ï¼Œéœ€è¦æ›´ä¸“ä¸šçš„å·¥å…·å’Œé¢†åŸŸçŸ¥è¯†ã€‚å› æ­¤å°†ä¸“ç”¨å·¥å…·ä¸åŸºç¡€æ¨¡å‹æ•´åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥å……åˆ†å‘æŒ¥å®ƒä»¬å„è‡ªçš„ä¼˜åŠ¿ã€‚ä¸“ç”¨å·¥å…·å¯ä»¥è§£å†³æ¨¡å‹æ—¶æ•ˆæ€§ä¸è¶³ã€å¢å¼ºä¸“ä¸šçŸ¥è¯†ã€æé«˜å¯è§£é‡Šæ€§å’Œé²æ£’æ€§çš„é—®é¢˜ã€‚è€ŒåŸºç¡€æ¨¡å‹åˆ™å…·å¤‡ç±»äººçš„æ¨ç†è§„åˆ’èƒ½åŠ›ï¼Œå¯ä»¥ç†è§£å¤æ‚çš„æ•°æ®å’Œåœºæ™¯ï¼Œå¹¶ä¸ç°å®ä¸–ç•Œè¿›è¡Œäº¤äº’ã€‚

åœ¨æœ¬æœŸå¼€æ”¾æ¨¡å‹å·¥ç¨‹åŒ–éƒ¨ç½²å’ŒChatBotåŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å°†ç»§ç»­åœ¨æµ‹è¯•å¼€æºé¢†åŸŸæ·±è€•æŠ•å…¥ã€‚ååŒç¤¾åŒºå¿—è¶£ç›¸æŠ•å¼€å‘è€…ä»¬ï¼Œä¸€èµ·æ‰“é€ æµ‹è¯•é¢†åŸŸæœ€é¢†å…ˆçš„Toolså·¥ç¨‹ä½“ç³»ã€æ™ºèƒ½æµ‹è¯•åŠ©ç†å’Œæµ‹è¯•å¼€æºå·¥ç¨‹ï¼

## å¿«é€Ÿä½¿ç”¨ï¼ˆQuickStartï¼‰
### å‰ç½®å‡†å¤‡

#### æ¨¡å‹ä¸‹è½½

æ‚¨å¯åœ¨[modelscope](https://modelscope.cn/models/codefuse-ai/TestGPT-7B)æˆ–[huggingface](https://huggingface.co/codefuse-ai/TestGPT-7B)ä¸Šè·å–åˆ°æ¨¡å‹çš„è¯¦ç»†ä¿¡æ¯å¹¶ä¸‹è½½æ¨¡å‹æ–‡ä»¶ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼š
1ï¼‰å¦‚æœæ‚¨é€šè¿‡modelscopeä¸‹è½½æ¨¡å‹ï¼Œä¸‹è½½æ–¹å¼å¯å‚è€ƒï¼š[ä¸‹è½½è¯´æ˜](https://www.modelscope.cn/docs/%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%8B%E8%BD%BD#%E4%BD%BF%E7%94%A8Git%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B)ï¼›
2ï¼‰å¦‚æœæ‚¨é€šè¿‡huggingfaceä¸‹è½½æ¨¡å‹ï¼Œè¯·ç¡®ä¿æ‚¨å¯ä»¥æ­£å¸¸è®¿é—®huggingfaceã€‚

#### ç¯å¢ƒå®‰è£…

- python>=3.8
- transformers==4.33.2

```plain
git clone https://github.com/codefuse-ai/Test-Agent
cd Test-Agent
pip install -r requirements.txt
```

åœ¨å¼€å§‹è¿è¡ŒTestGPT-7Bæ¨¡å‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„æ‰§è¡Œç¯å¢ƒæ‹¥æœ‰å¤§çº¦14GBçš„æ˜¾å­˜ã€‚
### å¯åŠ¨æœåŠ¡

é¡¹ç›®æä¾›äº†ç½‘é¡µç«¯å¿«é€Ÿæ­å»ºUIçš„èƒ½åŠ›èƒ½å¤Ÿæ›´ç›´è§‚çš„å±•ç¤ºæ¨¡å‹äº¤äº’å’Œæ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç®€å•çš„å‡ ä¸ªå‘½ä»¤æŠŠå‰ç«¯é¡µé¢å”¤é†’å¹¶å®æ—¶è°ƒç”¨æ¨¡å‹èƒ½åŠ›ã€‚åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œä¾æ¬¡å¯åŠ¨ä»¥ä¸‹æœåŠ¡ï¼š

1.**å¯åŠ¨controller**
![controller](https://github.com/codefuse-ai/Test-Agent/assets/103973989/e68ce187-c9f1-4ce8-9d59-ff9d8348d0ac)
python3 -m chat.server.controller

2.**å¯åŠ¨æ¨¡å‹worker**
![work](https://github.com/codefuse-ai/Test-Agent/assets/103973989/073e4e79-4005-4c98-87f7-0eaa0b2b1e22)
python3 -m chat.server.model_worker --model-path models/TestGPT-7B --device mps

ï¼ˆmodels/TestGPT-7B ä¸ºå®é™…æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼‰

å¯¹äºå¯åŠ¨æ–¹å¼ï¼Œå¯ä»¥æŒ‰éœ€é€‰æ‹©ä»¥ä¸‹å‡ ç§é…ç½®é€‰é¡¹ï¼š
- --device mps ç”¨äºåœ¨Macç”µè„‘ä¸Šå¼€å¯GPUåŠ é€Ÿçš„é€‰é¡¹ï¼ˆApple Siliconæˆ–AMD GPUsï¼‰ï¼›
- --device xpu ç”¨äºåœ¨Intel XPUä¸Šå¼€å¯åŠ é€Ÿçš„é€‰é¡¹ï¼ˆIntel Data Center and Arc A-Series GPUsï¼‰ï¼›
  - éœ€å®‰è£…[Intel Extension for PyTorch](https://intel.github.io/intel-extension-for-pytorch/xpu/latest/tutorials/installation.html)
  - è®¾ç½®OneAPIç¯å¢ƒå˜é‡ï¼šsource /opt/intel/oneapi/setvars.sh
- --device npu ç”¨äºåœ¨åä¸ºAIå¤„ç†å™¨ä¸Šå¼€å¯åŠ é€Ÿçš„é€‰é¡¹ï¼›
  - éœ€å®‰è£…[Ascend PyTorch Adapter](https://github.com/Ascend/pytorch)
  - è®¾ç½®CANNç¯å¢ƒå˜é‡ï¼šsource /usr/local/Ascend/ascend-toolkit/set_env.sh
- --device cpu å•ç‹¬ä½¿ç”¨CPUè¿è¡Œçš„é€‰é¡¹ï¼Œä¸éœ€è¦GPUï¼›
- --num-gpus 2 æŒ‡å®šå¹¶å‘gpuè¿è¡Œçš„é€‰é¡¹ã€‚

3. **å¯åŠ¨webæœåŠ¡**
python3 -m chat.server.gradio_testgpt
![web](https://github.com/codefuse-ai/Test-Agent/assets/103973989/340dae35-573b-4046-a3e8-e87a91453601)
å¾…æœåŠ¡å‡†å¤‡å°±ç»ªåï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€æœ¬åœ°å¯åŠ¨çš„webæœåŠ¡åœ°å€ http://0.0.0.0:7860 ï¼Œå°±èƒ½çœ‹åˆ°å®Œæ•´çš„å‰ç«¯é¡µé¢äº†ã€‚åœ¨é¡µé¢ä¸‹æ–¹åŒ…å«äº†ã€å•æµ‹ç”Ÿæˆã€‘å’Œã€Assertè¡¥å…¨ã€‘çš„ä¸¤ä¸ªä¾‹å­ï¼Œç‚¹å‡»æŒ‰é’®åä¼šè‡ªåŠ¨ç”Ÿæˆä¸€æ®µæ ·ä¾‹æ–‡æœ¬åˆ°è¾“å…¥æ¡†ä¸­ï¼Œç‚¹å‡»SendæŒ‰é’®å°±ä¼šè§¦å‘æ¨¡å‹è¿è¡Œï¼Œä¹‹åè€å¿ƒç­‰å¾…ä¸€æ®µæ—¶é—´åï¼ˆè¿è¡Œæ—¶é—´è§†æœ¬æœºæ€§èƒ½è€Œå®šï¼‰å³å¯çœ‹åˆ°å®Œæ•´çš„å›ç­”äº†ã€‚
![demo](https://github.com/codefuse-ai/Test-Agent/assets/103973989/fd24274c-729b-4ce7-8763-a083b39300fb)

## ğŸ¤— è‡´è°¢
æœ¬é¡¹ç›®åŸºäº[FastChat](https://github.com/lm-sys/FastChat) æ„å»ºï¼Œåœ¨æ­¤æ·±æ·±æ„Ÿè°¢ä»–ä»¬çš„å¼€æºè´¡çŒ®ï¼

## è”ç³»æˆ‘ä»¬

![weixin](https://github.com/codefuse-ai/Test-Agent/assets/106229399/bacee8aa-c720-4500-920d-99f5c86e6ada)



